function wrapImageWithLightBox(){const e=document.querySelectorAll("#article-content img:not(#header img)"),t=Array.from(e).map(e=>e.getAttribute("src"));let o=0;const r=document.createElement("div");r.id="lightbox",Object.assign(r.style,{display:"none",position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:"1000",justifyContent:"center",alignItems:"center",textAlign:"center",overflow:"hidden"});const c=document.createElement("img");Object.assign(c.style,{maxWidth:"80%",maxHeight:"80%"}),r.appendChild(c);const n=(e,t)=>{const o=document.createElement("a");return o.innerHTML=`<i class="${e}"></i>`,Object.assign(o.style,{position:"absolute",[t]:"10px",top:"50%",transform:"translateY(-50%)",color:"white",fontSize:"2em",cursor:"pointer"}),o},l=n("fa fa-chevron-left","left"),a=n("fa fa-chevron-right","right");r.appendChild(l),r.appendChild(a),document.body.appendChild(r);const i=e=>{c.src=t[e],r.style.display="flex",document.body.style.overflow="hidden"};l.addEventListener("click",()=>{o=(o-1+t.length)%t.length,i(o)}),a.addEventListener("click",()=>{o=(o+1)%t.length,i(o)}),r.addEventListener("click",e=>{[c,l,a,l.querySelector("i"),a.querySelector("i")].includes(e.target)||(r.style.display="none",document.body.style.overflow="auto")});let s=0;r.addEventListener("wheel",e=>{const t=(new Date).getTime();t-s<200||(s=t,e.preventDefault(),e.deltaY<0?l.click():a.click())}),e.forEach((e,t)=>{const r=e.parentElement,c=e.getAttribute("src"),n=document.createElement("a");n.className="gallery",n.setAttribute("href",c),n.appendChild(e),r.appendChild(n),n.addEventListener("click",e=>{e.preventDefault(),o=t,i(o)})})}function toggleSidebar(e){const t=document.querySelector("#sidebar"),o=document.querySelector("#content"),r=document.querySelector("#header"),c=document.querySelector("#footer"),n=document.querySelector("#sidebar-toggle i"),{toggleIcon:l,sidebar:a,content:i,header:s,footer:d}={on:{toggleIcon:["fa-arrow-right","fa-close"],sidebar:"on",content:"content-on",header:"header-on",footer:"header-on"},off:{toggleIcon:["fa-close","fa-arrow-right"],sidebar:"off",content:"content-on",header:"off",footer:"off"}}[e];n.classList.replace(...l),t.className=a,"on"===e&&window.matchMedia("(min-width: 1100px)").matches&&(o.classList.toggle(i),r.className=s,c.className=d),"off"===e&&(o.classList.toggle(i),o.classList.add("off"),r.className=s,c.className=d)}function treeNodeDirClickEvent(){const e=document.querySelector("#tree .active");e&&showActiveNodeChildren(e,!0),document.addEventListener("click",function(e){if(e.target.matches("#tree li.file > a, #tree li.directory > a")){e.preventDefault(),toggleActiveNodeTree(e.target);document.querySelectorAll("#tree .fa-caret-up").forEach(e=>e.classList.replace("fa-caret-up","fa-caret-down"))}})}function switchTreeOrIndex(){const e=document.querySelector("#sidebar-toggle"),t=document.querySelector("#sidebar");if(e.addEventListener("click",()=>{t.classList.contains("on")?toggleSidebar("off"):toggleSidebar("on")}),document.body.addEventListener("click",e=>{if(window.matchMedia("(max-width: 1100px)").matches){const t=document.querySelector("#sidebar");!e.target.closest("#sidebar")&&t.classList.contains("on")&&toggleSidebar("off")}}),window.matchMedia("(min-width: 1100px)").matches)return toggleSidebar("on");toggleSidebar("off")}function activeArticleToc(){document.querySelectorAll(".article-toc").forEach(e=>{e.innerHTML="",e.style.display="none",e.classList.remove("active-toc")});const e=document.querySelector("#tree li.file.active, #tree li.directory .directory.active");if(!e)return;const t=e.parentElement.querySelector(".article-toc");t.classList.add("active-toc"),t.style.display="block";const o=document.querySelector("#article-content").querySelectorAll("h1, h2, h3, h4, h5, h6")||[],r=[],c=[];o.forEach(e=>{const t=parseInt(e.tagName.slice(1),10),o={level:t,id:e.id,title:e.querySelector("a").getAttribute("title"),children:[]};for(;c.length>0&&c[c.length-1].level>=t;)c.pop();c.length>0?c[c.length-1].children.push(o):r.push(o),c.push(o)});const n=(e,t)=>{e.forEach(e=>{const o=document.createElement("li"),r=document.createElement("a");if(r.href=`#${e.id}`,r.textContent=e.title,o.appendChild(r),e.children.length>0){const t=document.createElement("ul");o.appendChild(t),n(e.children,t)}t.appendChild(o)})},l=document.createElement("ul");t.appendChild(l),n(r,l);(document.querySelectorAll(".article-toc a")||[]).forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();const o=decodeURIComponent(e.getAttribute("href")),r=document.querySelector(o);window.scrollTo({top:r.offsetTop,behavior:"smooth"}),setTimeout(()=>location.hash=o,500)})});const a=document.querySelectorAll(".headerlink");window.addEventListener("scroll",function(){const e=document.querySelector("#article-content");if(window.scrollY+window.innerHeight-300>=e.scrollHeight){return void document.querySelectorAll(".article-toc a").forEach(e=>e.classList.add("read"))}a.forEach(e=>{const t=document.querySelectorAll(`.article-toc a[href="${e.getAttribute("href")}"]`);e.getBoundingClientRect().top+window.scrollY<=window.scrollY+100?t.forEach(e=>{e.classList.add("read"),e.parentNode.style.color="#c7bb9c"}):t.forEach(e=>{e.classList.remove("read"),e.parentNode.style.color="#000000"})})});t.querySelectorAll("ul").forEach(e=>{e.style.display="block"}),a.forEach(e=>{const t=document.querySelectorAll(`.article-toc a[href="${e.getAttribute("href")}"]`);e.getBoundingClientRect().top+window.scrollY<=window.scrollY+100?t.forEach(e=>{e.classList.add("read"),e.parentNode.style.color="#c7bb9c"}):t.forEach(e=>{e.classList.remove("read"),e.parentNode.style.color="#000000"})})}function toggleTreeNodes(){document.querySelectorAll("#tree > ul").forEach(e=>{const t=document.createElement("i");t.className="fa fa-caret-down",t.setAttribute("aria-hidden","true"),Object.assign(t.style,{position:"absolute",right:"20px",cursor:"pointer",color:"#454545"}),t.addEventListener("mouseover",()=>{t.style.color="rgb(122, 122, 122)"}),t.addEventListener("mouseout",()=>{t.style.color="#454545"}),e.prepend(t),t.addEventListener("click",()=>{const o=e.querySelectorAll("li.directory .fa");if(t.classList.contains("fa-caret-down"))return t.classList.replace("fa-caret-down","fa-caret-up"),void Array.from(o).forEach(e=>{if(!e.classList.contains("fa-minus-square-o")){toggleActiveNodeTree(e.closest("li.directory"))}});t.classList.remove("fa-caret-up"),t.classList.add("fa-caret-down"),o.forEach(e=>{if(!e.classList.contains("fa-plus-square-o")){toggleActiveNodeTree(e.closest("li.directory"))}})})})}function toggleActiveNodeTree(e){const t=e.closest("ul"),o=e.querySelector(".fa"),r=t.querySelector("li");if(o){if(o.classList.contains("fa-minus-square-o"))return r&&Array.from(r.children).forEach(e=>{"ul"===e.tagName.toLowerCase()&&(e.style.display="")}),void o.classList.replace("fa-minus-square-o","fa-plus-square-o")}r&&Array.from(r.children).forEach(e=>{"ul"===e.tagName.toLowerCase()&&(e.style.display="block")}),o&&o.classList.replace("fa-plus-square-o","fa-minus-square-o")}function showActiveNodeChildren(e,t){if("tree"===(e?.getAttribute("id")||""))return;if("ul"===(e?.tagName.toLowerCase()||"")&&(e.style.display="block",t)){const t=e.parentNode.children;Array.from(t).forEach(e=>{e.style.display="block";if("a"===e.tagName.toLowerCase()){e.style.display="inline";const t=e.querySelector(".fa-plus-square-o");t?.classList.replace("fa-plus-square-o","fa-minus-square-o")}})}showActiveNodeChildren(e.parentElement,t);"a"===e.tagName.toLowerCase()&&toggleActiveNodeTree(e)}function pureFetchLoading(e){e=e||location.href,fetch(e).then(e=>e.text()).then(e=>{const t=(new DOMParser).parseFromString(e,"text/html"),o=t.querySelector("meta[name='keywords']")?.getAttribute("content"),r=t.querySelector("meta[name='description']")?.getAttribute("content");document.title=t.title,document.querySelector("meta[name='keywords']").setAttribute("content",o),document.querySelector("meta[name='description']").setAttribute("content",r);const c=t.querySelector("#content");if(!c)return location.href="/404";document.querySelector("#content").innerHTML=c.innerHTML,document.querySelector("#tree .active")?.classList.remove("active");const n=decodeURI(window.location.pathname).slice(0,-1);if(n.length){let e=document.querySelectorAll(`#tree li.file a[title='${n}']`);if(e.length){if(document.querySelectorAll(".fa-minus-square-o").forEach(e=>{e.classList.replace("fa-minus-square-o","fa-plus-square-o")}),document.querySelectorAll("#tree ul").forEach(e=>{e.style.display="none"}),e.length>1){const t=document.querySelector("#article-categories span:last-child a")?.innerHTML.trim();if(t){const o=document.querySelectorAll("#tree li.directory a:contains('"+t+"')");e=Array.from(o).map(e=>e.nextElementSibling.querySelector(`a[title='${n}']`)).filter(e=>e)}}e[0].parentNode.classList.add("active");showActiveNodeChildren(document.querySelector("#tree .active"),!0)}if(!e.length){const e=document.querySelector(`#tree li.directory a[title='${n}']`);e?.classList.add("active")}activeArticleToc()}wrapImageWithLightBox(),reloadMarkScript()}).catch(e=>console.error("Error loading content:",e))}function reloadMarkScript(){document.querySelectorAll("script[reload]").forEach(e=>{const t=e.parentElement;if(t){const o=document.createElement("script");o.innerHTML=e.innerHTML;for(const{name:t,value:r}of e.attributes)o.setAttribute(t,r);t.removeChild(e),t.appendChild(o)}})}function setupNavigation(){document.addEventListener("click",function(e){const t=e.target.closest("a");if(t&&t.matches("#menu a:not(.item-icon), #index a, #tree li.file > a[href], #tree li.directory > a[href], .post-guide a")){e.preventDefault();const o=t.href;history.pushState(null,"",o),pureFetchLoading(o),window.scrollTo({top:0,behavior:"smooth"})}}),window.addEventListener("popstate",function(e){null!==e.state&&(pureFetchLoading(),window.scrollTo({top:0,behavior:"smooth"}))})}function searchTreeNode(){const e=document.getElementById("search-input");e.addEventListener("input",function(e){e.preventDefault();const t=e.currentTarget.value,o=document.querySelectorAll(".fa-minus-square-o"),r=document.querySelectorAll("#tree ul");if(!t){const e=document.querySelector("#tree .active");if(o.forEach(e=>{e.classList.replace("fa-minus-square-o","fa-plus-square-o")}),r.forEach(e=>e.style.display="none"),e)return showActiveNodeChildren(e,!0);const t=document.querySelector("#tree");return void Array.from(t.children).forEach(e=>{e.style.display="block"})}r.forEach(e=>{e.style.display="none"});const c=document.querySelectorAll("#tree li a"),n=Array.from(c).filter(e=>e.textContent.includes(t));n.length&&n.forEach(e=>{toggleActiveNodeTree(e),showActiveNodeChildren(e.parentElement,!1);const t=e.title;document.querySelectorAll(`#tree li.directory:has(a[title="${t}"])`).forEach(e=>{e.querySelector(".fa").classList.replace("fa-plus-square-o","fa-minus-square-o")})})}),e.addEventListener("keyup",e=>{if(e.preventDefault(),"Enter"===e.code){const t=e.currentTarget.value;t&&window.open(window.searchEngine+t+"%20site:"+window.homeHost,"_blank")}})}window.onload=function(){wrapImageWithLightBox(),treeNodeDirClickEvent(),switchTreeOrIndex(),toggleTreeNodes(),pureFetchLoading(),setupNavigation(),activeArticleToc(),searchTreeNode()};